name: Validate Azure Credentials

on:
  workflow_dispatch

jobs:
  checkAzureSecret:
    runs-on: ubuntu-latest
    steps:
      - name: Test Secret Accessibility
        run: |
          if [[ -z "${{ secrets.AZURE_CREDENTIALS }}" ]]; then
            echo "❌ Secret is missing!"
            exit 1
          else
            echo "✅ Secret is available!"
          fi

      - name: Install jq (If Missing)
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Extract Credentials and Authenticate
        run: |
          echo '${{ secrets.AZURE_CREDENTIALS }}' > credentials.json

          CLIENT_ID=$(jq -r '.clientId' credentials.json)
          CLIENT_SECRET=$(jq -r '.clientSecret' credentials.json)
          TENANT_ID=$(jq -r '.tenantId' credentials.json)

          az login --service-principal \
          --username "$CLIENT_ID" \
          --password "$CLIENT_SECRET" \
          --tenant "$TENANT_ID"

      - name: Verify Subscription Access
        run: az account show
